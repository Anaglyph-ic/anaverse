(()=>{function e(){return e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},e.apply(this,arguments)}var t=new OffscreenCanvas(1e3,200).getContext("2d");function i(e,t){return e?e.length>t?e.substring(0,t)+"…":e:""}onmessage=function(l){var a=l.data.operation,o="";switch(l.data.feedType){case"teztok-nft-liquidity":case"teztok-nft-lat-sales":case"teztok-nft-lat-transact":case"teztok-nft-lat-purchases":case"teztok-nft-livefeed":case"teztok-sales-nft-livefeed":a.chain="tezos",o="https://assets.objkt.media/file/assets-003/"+a.token.fa2_address+"/"+a.token.token_id+"/thumb288",a.price&&(a.price_in_usd||(a.price_in_usd=a.price*a.quotes.usd),a.fiat="USD $"+Math.floor(a.price_in_usd/1e4)/100,a.price=a.price/1e6+" ꜩ"),a.previousSale&&(a.usdProfit="USD $ ".concat(Math.floor(a.previousSale.profit.profit_in_usd/1e4)/100),a.cryptoProfit="".concat(Math.floor(a.previousSale.profit.profit_in_crypto/1e4)/100," ꜩ"),a.positiveProfit=Math.floor(a.previousSale.profit.profit_in_usd/1e4)/100>=0);break;case"gmstudio-nft-livefeed":case"artblocks-nft-livefeed":case"superrare-nft-livefeed":case"bright-nft-livefeed":case"verse-nft-livefeed":case"genart-nft-livefeed":case"artblocks%3Agmstudio%3Abright%3Agenart%3Asuperrare%3Averse-nft-livefeed":a.chain="ethereum",o=a.imageUrlOS,a.price=a.valueETH+" ETH",a.fiat="USD $"+a.valueUSD,a.previousSale&&(a.usdProfit="USD $ ".concat(Math.floor(100*a.previousSale.profit.profit_in_usd)/100),a.cryptoProfit="ETH ".concat(Math.floor(100*a.previousSale.profit.profit_in_crypto)/100),a.positiveProfit=Math.floor(100*a.previousSale.profit.profit_in_usd)/100>=0);break;case"verse-nft-livefeed":o="";break;case"news-feed-rss":o=a.imgurl}a.imgurl=o,this.fetch(o).then((function(e){var t=e.body.getReader();return new ReadableStream({start:function(e){return function i(){return t.read().then((function(t){var r=t.done,l=t.value;if(!r)return e.enqueue(l),i();e.close()}))}()}})})).then((function(e){return new Response(e)})).then((function(e){return e.blob()})).then((function(o){"news-feed-rss"===l.data.feedType?r(a,o,l.data.feedType):function(r,l,a){var o=e({},r);function s(e){if(t.fillStyle="white",t.fillRect(0,0,1e3,200),e.hasOwnProperty("userInvolved")&&e.userInvolved&&(t.fillStyle="rgba(0,255,235,0.5)",t.fillRect(200,0,600,200)),t.fillStyle="black",t.textAlign="left",t.scale(1,1),t.strokeRect(0,0,200,200),t.strokeRect(200,0,600,40),t.font="28px monospace",t.fillText(i("1/".concat(e.token.editions," - ").concat(e.token.name),35),210,30),t.font="22px monospace",t.strokeRect(200,40,210,60),e.token.artist_profile?(e.token.artist_profile.alias&&t.fillText("by "+i(e.token.artist_profile.alias,11),210,60),e.token.artist_profile.twitter&&t.fillText("@"+i(e.token.artist_profile.twitter,11),210,90)):t.fillText(i(e.token.artist_address,10),210,90),t.strokeRect(200,100,210,65),t.textAlign="right",t.font="22px monospace bolder",e.fiat&&t.fillText(e.fiat,400,125),e.price&&t.fillText(e.price,400,155),t.strokeRect(200,165,210,35),t.font="22px monospace",t.fillText(e.token.platform,400,190),t.textAlign="center",e.seller_profile?t.fillText(i(e.seller_profile.alias&&e.seller_profile.alias.length>0?e.seller_profile.alias:e.seller_address,25),600,70):t.fillText(i(e.seller_address,25),600,70),e.buyer_profile?t.fillText(i(e.buyer_profile.alias&&e.buyer_profile.alias.length>0?e.buyer_profile.alias:e.buyer_address,25),600,150):t.fillText(i(e.buyer_address,25),600,150),e.implements&&(t.fillText(e.implements,500,110),t.fillText("↓",600,110)),t.strokeRect(410,165,390,40),t.fillText(e.type,600,190),t.strokeRect(800,0,200,200),t.strokeRect(0,0,1e3,200),e.hasOwnProperty("previousSale")){t.textAlign="left";var r=e.positiveProfit?"rgba(34,139,34)":"rgba(210,43,43)";t.fillStyle=r,t.fillRect(800,0,200,200),t.fillStyle="white";var l=e.previousSale.profit.profit_in_usd>=0?"PROFIT":"LOSS";t.fillText(l,810,40),t.fillText(e.usdProfit,810,70),t.fillText(e.cryptoProfit,810,90)}}o.feedType=a,t.textAlign="center",l?Promise.all([createImageBitmap(l)]).then((function(e){s(o),t.drawImage(e[0],1,1,198,198),o.img=t.getImageData(0,0,1e3,200),postMessage(o)})).catch((function(e){s(o),t.fillText("NOT FOUND",100,100),o.img=t.getImageData(0,0,1e3,200),postMessage(o)})):(s(o),t.fillText("NOT FOUND",100,100),o.img=t.getImageData(0,0,1e3,200),postMessage(o))}(a,o,l.data.feedType)})).catch((function(e){return console.error(e)}))};var r=function(r,l,a){var o=e({},r);function s(e){t.fillStyle="white",t.fillRect(0,0,1e3,200),t.fillStyle="black",t.textAlign="left",t.scale(1,1),t.strokeRect(0,0,200,200),t.font="28px monospace",t.fillText(i(e.title,39),360,30),t.font="22px monospace",t.fillText(e.description.substring(0,50),365,70),t.fillText(e.description.substring(50,100),365,90),t.fillText(e.description.substring(100,150),365,120),t.fillText(e.description.substring(150,200),365,120)}o.feedType=a,l?Promise.all([createImageBitmap(l)]).then((function(e){s(o),t.drawImage(e[0],1,1,350,198),o.img=t.getImageData(0,0,1e3,200),postMessage(o)})).catch((function(e){s(o),t.fillText("NOT FOUND",100,100),o.img=t.getImageData(0,0,1e3,200),postMessage(o)})):(s(o),t.fillText("NOT FOUND",100,100),o.img=t.getImageData(0,0,1e3,200),postMessage(o))}})();
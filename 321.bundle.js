(()=>{function e(e,t,a,o,n,s){var r={room:e.room,skybox:e.skybox,name:JSON.stringify(e.name),artifact:s,contract:t,collection:e.collection,id:a,curator:o,gallery:[],thumbnail:n,type:"remote"};if(e.startPoint){for(const t in e.startPoint)if("direction"!=t&&"position"!=t)delete e.startPoint[t];else for(const a in e.startPoint[t])"x"!=a&&"y"!=a&&"z"!=a&&delete e.startPoint[t][a];r.startPoint=e.startPoint}e.hasOwnProperty("gallery")&&(e.gallery.forEach((e=>{for(const t in e)switch(t){case"position":case"rotation":case"scale":for(const a in e[t])"x"===a||"y"===a||"z"===a||delete e[t][a];break;case"objktMetaData":case"tezosMetaData":case"ethereumMetaData":case"openSeaMetaData":case"solanaMetaData":case"fxMetaData":case"tokenType":case"block":case"sculpture":case"IIIFdata":case"datavis":case"note":break;default:delete e[t]}})),e.gallery.forEach((e=>{var t=!1;if(e.hasOwnProperty("objktMetaData")){var a=!1;for(const t in e.objktMetaData)"contract"===t||"token_id"===t?a=!0:delete e.objktMetaData[t];a&&(t=!0)}else"block"!==e.tokenType&&"sculpture"!==e.tokenType&&"datavis"!==e.tokenType&&"openSea"!==e.tokenType&&"tezos"!==e.tokenType&&"ethereum"!==e.tokenType&&"solana"!==e.tokenType&&"IIIF"!==e.tokenType||(t=!0);t&&r.gallery.push(e)}))),e.hasOwnProperty("audioguide")&&(r.audioguide={mainTrack:e.audioguide.mainTrack}),r.gallery.length>0&&postMessage(r)}const t=new FileReader;t.onload=function(e){const t=JSON.parse(e.target.result),a=new Date,o={collection:t.collection,gallery:[],name:t.name,room:t.room,skybox:t.skybox,type:"local",timeId:a};if(t.startPoint){for(const e in t.startPoint)if("direction"!=e&&"position"!=e)delete t.startPoint[e];else for(const a in t.startPoint[e])"x"!=a&&"y"!=a&&"z"!=a&&delete t.startPoint[e][a];o.startPoint=t.startPoint}t.hasOwnProperty("gallery")&&(t.gallery.forEach((e=>{for(const t in e)switch(t){case"position":case"rotation":case"scale":for(const a in e[t])"x"===a||"y"===a||"z"===a||delete e[t][a];break;case"objktMetaData":case"tezosMetaData":case"ethereumMetaData":case"openSeaMetaData":case"solanaMetaData":case"fxMetaData":case"tokenType":case"block":case"sculpture":case"IIIFdata":case"datavis":case"note":break;default:delete e[t]}})),t.gallery.forEach((e=>{var t=!1;if(e.hasOwnProperty("objktMetaData")){var a=!1;for(const t in e.objktMetaData)"contract"===t||"token_id"===t?a=!0:delete e.objktMetaData[t];a&&(t=!0)}else"block"!==e.tokenType&&"sculpture"!==e.tokenType&&"datavis"!==e.tokenType&&"openSea"!==e.tokenType&&"tezos"!==e.tokenType&&"ethereum"!==e.tokenType&&"solana"!==e.tokenType&&"IIIF"!==e.tokenType||(t=!0);t&&o.gallery.push(e)}))),t.hasOwnProperty("audioguide")&&(o.audioguide={mainTrack:t.audioguide.mainTrack}),o.gallery.length>0&&postMessage(o)},onmessage=function(a){switch(a.data.type){case"remote":(t=>{t.data.galleryURLs.forEach((t=>{fetch(t.galurl).then((e=>e.json())).then((a=>{404===a.status?fetch(t.galurl+"/gallery.json").then((e=>e.json())).then((a=>e(a,t.contract,t.id,t.curator,t.thumbnail,t.artifact))):e(a,t.contract,t.id,t.curator,t.thumbnail,t.artifact)}))}))})(a);break;case"local":(e=>{t.readAsText(e.data.path)})(a)}}})();
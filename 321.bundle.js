(()=>{const e=new FileReader;e.onload=function(e){const a=JSON.parse(e.target.result),t={collection:a.collection,gallery:[],name:a.name,room:a.room,skybox:a.skybox,type:"local"};a.gallery.forEach((e=>{for(const a in e)switch(a){case"position":case"rotation":case"scale":for(const t in e[a])"x"===t||"y"===t||"z"===t||delete e[a][t];break;case"objktMetaData":case"openSeaMetaData":case"fxMetaData":case"tokenType":case"block":case"sculpture":break;default:delete e[a]}})),a.gallery.forEach((e=>{var a=!1;if(e.hasOwnProperty("objktMetaData")){var o=!1;for(const a in e.objktMetaData)"contract"===a||"token_id"===a?o=!0:delete e.objktMetaData[a];o&&(a=!0)}else"block"!==e.tokenType&&"sculpture"!==e.tokenType&&"openSea"!==e.tokenType||(a=!0);a&&t.gallery.push(e)})),t.gallery.length>0&&postMessage(t)},onmessage=function(a){switch(a.data.type){case"remote":(e=>{e.data.galleryURLs.forEach((e=>{fetch(e.galurl).then((e=>e.json())).then((a=>{var t,o,c,r,s,n,l;a&&(t=a,o=e.contract,c=e.id,r=e.curator,s=e.thumbnail,n=e.artifact,l={room:parseInt(t.room),skybox:parseInt(t.skybox),name:JSON.stringify(t.name),artifact:n,contract:o,collection:t.collection,id:c,curator:r,gallery:[],thumbnail:s,type:"remote"},t.hasOwnProperty("gallery")&&(t.gallery.forEach((e=>{for(const a in e)switch(a){case"position":case"rotation":case"scale":for(const t in e[a])"x"===t||"y"===t||"z"===t||delete e[a][t];break;case"objktMetaData":case"openSeaMetaData":case"fxMetaData":case"tokenType":case"block":case"sculpture":case"IIIFdata":break;default:delete e[a]}})),t.gallery.forEach((e=>{var a=!1;if(e.hasOwnProperty("objktMetaData")){var t=!1;for(const a in e.objktMetaData)"contract"===a||"token_id"===a?t=!0:delete e.objktMetaData[a];t&&(a=!0)}else"block"!==e.tokenType&&"sculpture"!==e.tokenType&&"openSea"!==e.tokenType||(a=!0);a&&l.gallery.push(e)}))),t.hasOwnProperty("audioguide")&&(l.audioguide={mainTrack:t.audioguide.mainTrack}),l.gallery.length>0&&postMessage(l))}))}))})(a);break;case"local":(a=>{e.readAsText(a.data.path)})(a)}}})();
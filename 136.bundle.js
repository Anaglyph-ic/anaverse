(()=>{function a(a,e,t,o,n,r,i){var s={room:a.room,skybox:a.skybox,name:JSON.stringify(a.name),artifact:r,contract:e,collection:a.collection,id:t,curator:o,gallery:[],thumbnail:n,type:"remote"};if(a.startPoint){for(var c in a.startPoint)if("direction"!=c&&"position"!=c)delete a.startPoint[c];else for(var l in a.startPoint[c])"x"!=l&&"y"!=l&&"z"!=l&&delete a.startPoint[c][l];s.startPoint=a.startPoint}a.hasOwnProperty("gallery")&&(a.gallery.forEach((function(a){for(var e in a)switch(e){case"position":case"rotation":case"scale":for(var t in a[e])"x"===t||"y"===t||"z"===t||delete a[e][t];break;case"objktMetaData":case"tezosMetaData":case"ethereumMetaData":case"openSeaMetaData":case"solanaMetaData":case"tokenType":case"block":case"sculpture":case"IIIFdata":case"sculptureMetaData":case"datavis":case"note":break;default:delete a[e]}})),a.gallery.forEach((function(a){var e=!1;if(a.hasOwnProperty("objktMetaData")){var t=!1;for(var o in a.objktMetaData)"contract"===o||"token_id"===o?t=!0:delete a.objktMetaData[o];t&&(e=!0)}else"block"!==a.tokenType&&"sculpture"!==a.tokenType&&"datavis"!==a.tokenType&&"openSea"!==a.tokenType&&"tezos"!==a.tokenType&&"ethereum"!==a.tokenType&&"solana"!==a.tokenType&&"IIIF"!==a.tokenType||(e=!0);e&&s.gallery.push(a)}))),a.hasOwnProperty("audioguide")&&(s.audioguide={mainTrack:a.audioguide.mainTrack}),s.item=i,s.gallery.length>0&&("string"==typeof a.room||"number"==typeof a.room||postMessage(s))}var e=new FileReader;e.onload=function(a){var e=JSON.parse(a.target.result);switch(!0){case e.hasOwnProperty("room"):o(e);break;case e.hasOwnProperty("id"):"https://gallica.bnf.fr/gallicarama"===e.id&&t(e)}};var t=function(a){var e=[];a.items.forEach((function(a){var t="";a.hasOwnProperty("annotations")&&(a.annotations[0].items[0].metadata.forEach((function(a){"title"===a.label.none[0]&&(t+=a.value.none[0]+"\n")})),t+=a.annotations[0].items[0].body.value),e.push({url:a.items[0].items[0].body.id,note:t})}));var t=a.thumbnail[0].id.replace("full/,120/0","full/,200/0"),o={};a.metadata.forEach((function(a){o[a.label.none[0]]=a.value.none[0]})),postMessage({slides:e,display_uri:t,meta:o,type:"gallicarama"})};onmessage=function(t){switch(t.data.type){case"remote":!function(e){for(var t=e.data.galleryURLs,o=function(){var e=t[n];setTimeout((function(){fetch(e.galurl).then((function(a){return a.json()})).then((function(t){404===t.status?fetch(e.galurl+"/gallery.json").then((function(a){return a.json()})).then((function(t){return a(t,e.contract,e.id,e.curator,e.thumbnail,e.artifact,e.item)})):a(t,e.contract,e.id,e.curator,e.thumbnail,e.artifact,e.item)}))}),100*n)},n=0;n<t.length;n++)o()}(t);break;case"IIIF":case"local":!function(a){e.readAsText(a.data.path)}(t)}};var o=function(a){var e=new Date,t={collection:a.collection,gallery:[],name:a.name,room:a.room,skybox:a.skybox,type:"local",timeId:e};if(a.startPoint){for(var o in a.startPoint)if("direction"!=o&&"position"!=o)delete a.startPoint[o];else for(var n in a.startPoint[o])"x"!=n&&"y"!=n&&"z"!=n&&delete a.startPoint[o][n];t.startPoint=a.startPoint}a.hasOwnProperty("gallery")&&(a.gallery.forEach((function(a){for(var e in a)switch(e){case"position":case"rotation":case"scale":for(var t in a[e])"x"===t||"y"===t||"z"===t||delete a[e][t];break;case"objktMetaData":case"tezosMetaData":case"ethereumMetaData":case"openSeaMetaData":case"solanaMetaData":case"sculptureMetaData":case"tokenType":case"block":case"sculpture":case"IIIFdata":case"datavis":case"note":break;default:delete a[e]}})),a.gallery.forEach((function(a){var e=!1;if(a.hasOwnProperty("objktMetaData")){var o=!1;for(var n in a.objktMetaData)"contract"===n||"token_id"===n?o=!0:delete a.objktMetaData[n];o&&(e=!0)}else"block"!==a.tokenType&&"sculpture"!==a.tokenType&&"datavis"!==a.tokenType&&"openSea"!==a.tokenType&&"tezos"!==a.tokenType&&"ethereum"!==a.tokenType&&"solana"!==a.tokenType&&"IIIF"!==a.tokenType||(e=!0);e&&t.gallery.push(a)}))),a.hasOwnProperty("audioguide")&&(t.audioguide={mainTrack:a.audioguide.mainTrack}),t.gallery.length>0&&postMessage(t)}})();
(()=>{const e=new OffscreenCanvas(1e3,200).getContext("2d");function t(e,t){return e?e.length>t?e.substring(0,t)+"…":e:""}onmessage=function(a){const l=a.data.operation;var s="";switch(a.data.feedType){case"teztok-nft-liquidity":case"teztok-nft-lat-sales":case"teztok-nft-lat-purchases":case"teztok-nft-livefeed":s="https://assets.objkt.media/file/assets-003/"+l.token.fa2_address+"/"+l.token.token_id+"/thumb288",l.price&&(l.price_in_usd||(l.price_in_usd=l.price*l.quotes.usd),l.fiat="USD $"+Math.floor(l.price_in_usd/1e4)/100,l.price=l.price/1e6+" ꜩ");break;case"sansa-nft-livefeed":s=l.asset.imageThumbnailUrl,l.fiat="USD $"+l.price;break;case"reddit":s=l.img;break;case"gmstudio-nft-livefeed":case"artblocks-nft-livefeed":s=l.imageUrlOS,l.price=l.valueETH+" ETH",l.fiat="USD $"+l.valueUSD;break;case"verse-nft-livefeed":s=""}this.fetch(s).then((e=>{const t=e.body.getReader();return new ReadableStream({start:e=>function a(){return t.read().then((({done:t,value:l})=>{if(!t)return e.enqueue(l),a();e.close()}))}()})})).then((e=>new Response(e))).then((e=>e.blob())).then((s=>{switch(a.data.feedType){case"teztok-nft-lat-sales":case"teztok-nft-liquidity":case"teztok-nft-lat-purchases":case"teztok-nft-livefeed":case"sansa-nft-livefeed":case"verse-nft-livefeed":case"artblocks-nft-livefeed":case"gmstudio-nft-livefeed":!function(a,l,s){const i=Object.assign({},a);function r(a){e.fillStyle="white",e.fillRect(0,0,1e3,200),e.fillStyle="black",e.textAlign="left",e.scale(1,1),e.strokeRect(0,0,200,200),e.strokeRect(200,0,600,40),e.font="28px consolas",e.fillText(t(`1/${a.token.editions} - ${a.token.name}`,35),210,30),e.font="22px consolas",e.strokeRect(200,40,210,60),a.token.artist_profile?(a.token.artist_profile.alias&&e.fillText("by "+t(a.token.artist_profile.alias,11),210,60),a.token.artist_profile.twitter&&e.fillText("@"+t(a.token.artist_profile.twitter,11),210,90)):e.fillText(t(a.token.artist_address,15),210,90),e.strokeRect(200,100,210,65),e.textAlign="right",e.font="22px sans-serif bolder",e.fillText(a.fiat,400,125),e.fillText(a.price,400,155),e.strokeRect(200,165,210,35),e.font="22px consolas",e.fillText(a.token.platform,400,190),e.textAlign="center",a.seller_profile?e.fillText(t(a.seller_profile.alias&&a.seller_profile.alias.length>0?a.seller_profile.alias:a.seller_address,25),600,70):e.fillText(t(a.seller_address,25),600,70),a.buyer_profile?e.fillText(t(a.buyer_profile.alias&&a.buyer_profile.alias.length>0?a.buyer_profile.alias:a.buyer_address,25),600,150):e.fillText(t(a.buyer_address,25),600,150),a.implements&&(e.fillText(a.implements,500,110),e.fillText("↓",600,110)),e.strokeRect(410,165,390,40),e.fillText(a.type,600,190),e.strokeRect(800,0,200,200),e.strokeRect(0,0,1e3,200)}i.feedType=s,e.textAlign="center",l?Promise.all([createImageBitmap(l,0,0,200,200)]).then((t=>{r(i),e.drawImage(t[0],1,1,198,198),i.img=e.getImageData(0,0,1e3,200),postMessage(i)})).catch((t=>{r(i),e.fillText("NOT FOUND",100,100),i.img=e.getImageData(0,0,1e3,200),postMessage(i)})):(r(i),e.fillText("NOT FOUND",100,100),i.img=e.getImageData(0,0,1e3,200),postMessage(i))}(l,s,a.data.feedType);break;case"reddit":!function(a,l){const s=Object.assign({},a);function i(a){if(e.fillStyle="white",e.fillRect(0,0,1e3,200),e.fillStyle="black",e.textAlign="left",e.scale(1,1),e.strokeRect(0,0,200,200),e.font="28px consolas",e.font="22px consolas",a.author&&a.author.length>0&&e.fillText("by "+t(a.author,70),210,190),a.title){var l=a.title.split(" ");for(let t=0;t<l.length;t+=8){var s="";for(let e=0;e<8;e++)l[t+e]&&(s+=l[t+e]+" ");e.fillText(s,210,30+t/8*30)}}}e.textAlign="center",l?Promise.all([createImageBitmap(l)]).then((t=>{i(s),e.drawImage(t[0],1,1,198,198),s.img=e.getImageData(0,0,1e3,200),postMessage(s)})).catch((t=>{i(s),e.fillText("NOT FOUND",100,100),s.img=e.getImageData(0,0,1e3,200),postMessage(s)})):(i(s),e.fillText("NOT FOUND",100,100),s.img=e.getImageData(0,0,1e3,200),postMessage(s))}(l,s)}})).catch((e=>console.error(e)))}})();
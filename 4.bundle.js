(()=>{const e=new OffscreenCanvas(1e3,200).getContext("2d");function t(e,t){return e?e.length>t?e.substring(0,t)+"…":e:""}onmessage=function(i){const r=i.data.operation;var l="";switch(i.data.feedType){case"teztok-nft-liquidity":case"teztok-nft-lat-sales":case"teztok-nft-lat-transact":case"teztok-nft-lat-purchases":case"teztok-nft-livefeed":case"teztok-sales-nft-livefeed":l="https://assets.objkt.media/file/assets-003/"+r.token.fa2_address+"/"+r.token.token_id+"/thumb288",r.price&&(r.price_in_usd||(r.price_in_usd=r.price*r.quotes.usd),r.fiat="USD $"+Math.floor(r.price_in_usd/1e4)/100,r.price=r.price/1e6+" ꜩ"),r.previousSale&&(r.usdProfit="USD $ "+Math.floor(r.previousSale.profit.profit_in_usd/1e4)/100,r.cryptoProfit=Math.floor(r.previousSale.profit.profit_in_crypto/1e4)/100+" ꜩ",r.positiveProfit=Math.floor(r.previousSale.profit.profit_in_usd/1e4)/100>=0);break;case"gmstudio-nft-livefeed":case"artblocks-nft-livefeed":case"superrare-nft-livefeed":case"bright-nft-livefeed":case"verse-nft-livefeed":case"genart-nft-livefeed":case"artblocks%3Agmstudio%3Abright%3Agenart%3Asuperrare%3Averse-nft-livefeed":l=r.imageUrlOS,r.price=r.valueETH+" ETH",r.fiat="USD $"+r.valueUSD,r.previousSale&&(r.usdProfit="USD $ "+Math.floor(100*r.previousSale.profit.profit_in_usd)/100,r.cryptoProfit="ETH "+Math.floor(100*r.previousSale.profit.profit_in_crypto)/100,r.positiveProfit=Math.floor(100*r.previousSale.profit.profit_in_usd)/100>=0);break;case"verse-nft-livefeed":l=""}this.fetch(l).then((e=>{const t=e.body.getReader();return new ReadableStream({start:e=>function i(){return t.read().then((({done:t,value:r})=>{if(!t)return e.enqueue(r),i();e.close()}))}()})})).then((e=>new Response(e))).then((e=>e.blob())).then((l=>{i.data.feedType,function(i,r,l){const o=Object.assign({},i);function s(i){if(e.fillStyle="white",e.fillRect(0,0,1e3,200),i.hasOwnProperty("userInvolved")&&i.userInvolved&&(e.fillStyle="rgba(0,255,235,0.5)",e.fillRect(200,0,600,200)),e.fillStyle="black",e.textAlign="left",e.scale(1,1),e.strokeRect(0,0,200,200),e.strokeRect(200,0,600,40),e.font="28px monospace",e.fillText(t(`1/${i.token.editions} - ${i.token.name}`,35),210,30),e.font="22px monospace",e.strokeRect(200,40,210,60),i.token.artist_profile?(i.token.artist_profile.alias&&e.fillText("by "+t(i.token.artist_profile.alias,11),210,60),i.token.artist_profile.twitter&&e.fillText("@"+t(i.token.artist_profile.twitter,11),210,90)):e.fillText(t(i.token.artist_address,10),210,90),e.strokeRect(200,100,210,65),e.textAlign="right",e.font="22px monospace bolder",i.fiat&&e.fillText(i.fiat,400,125),i.price&&e.fillText(i.price,400,155),e.strokeRect(200,165,210,35),e.font="22px monospace",e.fillText(i.token.platform,400,190),e.textAlign="center",i.seller_profile?e.fillText(t(i.seller_profile.alias&&i.seller_profile.alias.length>0?i.seller_profile.alias:i.seller_address,25),600,70):e.fillText(t(i.seller_address,25),600,70),i.buyer_profile?e.fillText(t(i.buyer_profile.alias&&i.buyer_profile.alias.length>0?i.buyer_profile.alias:i.buyer_address,25),600,150):e.fillText(t(i.buyer_address,25),600,150),i.implements&&(e.fillText(i.implements,500,110),e.fillText("↓",600,110)),e.strokeRect(410,165,390,40),e.fillText(i.type,600,190),e.strokeRect(800,0,200,200),e.strokeRect(0,0,1e3,200),i.hasOwnProperty("previousSale")){e.textAlign="left";const t=i.positiveProfit?"rgba(34,139,34)":"rgba(210,43,43)";e.fillStyle=t,e.fillRect(800,0,200,200),e.fillStyle="white";const r=i.previousSale.profit.profit_in_usd>=0?"PROFIT":"LOSS";e.fillText(r,810,40),e.fillText(i.usdProfit,810,70),e.fillText(i.cryptoProfit,810,90)}}o.feedType=l,e.textAlign="center",r?Promise.all([createImageBitmap(r)]).then((t=>{s(o),e.drawImage(t[0],1,1,198,198),o.img=e.getImageData(0,0,1e3,200),postMessage(o)})).catch((t=>{s(o),e.fillText("NOT FOUND",100,100),o.img=e.getImageData(0,0,1e3,200),postMessage(o)})):(s(o),e.fillText("NOT FOUND",100,100),o.img=e.getImageData(0,0,1e3,200),postMessage(o))}(r,l,i.data.feedType)})).catch((e=>console.error(e)))}})();